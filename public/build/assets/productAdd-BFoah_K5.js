$("#product-image").on("change",function(d){var n=new FileReader;n.onload=function(s){$("#product-preview").html('<img src="'+s.target.result+'" alt="Product Image">')},n.readAsDataURL(this.files[0]);var i=$(this).val().split("\\").pop();$("#image-name").val(i)});$("#image-name").on("click",function(){$(this).prop("readonly",!1)});$(document).on("click","#save-product-btn",function(d){d.preventDefault();var n=$("#product-name").val().trim(),i=$("#product-price").val().trim(),s=$("#product-description").val().trim(),u=$("#product-status").val(),a=new FormData,o=$("#product-image")[0].files[0],c=$("#image-name").val().trim(),l=$("input[name='existingImage']").val(),p=$("input[name='productId']").val();a.append("product_name",n),a.append("product_price",i),a.append("description",s),a.append("is_sales",u),o&&(a.append("product_image",o),c?(a.append("productImageFileName",c),console.log("Appended custom image name:",c)):(a.append("productImageFileName",o.name),console.log("Appended original image name:",o.name))),!o&&l&&a.append("existingImage",l),console.log("exist image ",l),console.log(p),console.log(o),p?(a.append("product_id",p),$.ajax({url:"/api/products/updateProduct",type:"POST",data:a,processData:!1,contentType:!1,success:function(e){console.log(e.message),e.message.includes("thành công")?Swal.fire({icon:"success",title:"Cập nhật sản phẩm thành công!",text:e.message,timer:2e3,showConfirmButton:!1}).then(()=>{window.location.href="/productManager"}):Swal.fire({icon:"error",title:"Lỗi!",text:e.message})},error:function(e,g,f){let t="Đã xảy ra lỗi.";if(e.responseJSON){const r=e.responseJSON;if(t=r.message||t,r.errors){const m=Object.values(r.errors).flat().join(`
`);t+=`
`+m}}Swal.fire({icon:"error",title:"Lỗi!",text:t})}})):$.ajax({url:"/api/products/addProduct",type:"POST",data:a,processData:!1,contentType:!1,success:function(e){console.log(e),console.log("o day la message"+e.message),e.message.includes("thành công")?Swal.fire({icon:"success",title:"Cập nhật sản phẩm thành công!",text:e.message,timer:2e3,showConfirmButton:!1}).then(()=>{location.reload()}):Swal.fire({icon:"error",title:"Lỗi!",text:e.message})},error:function(e,g,f){let t="Đã xảy ra lỗi.";if(e.responseJSON){const r=e.responseJSON;if(t=r.message||t,r.errors){const m=Object.values(r.errors).flat().join(`
`);t+=`
`+m}}Swal.fire({icon:"error",title:"Lỗi!",text:t})}})});$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});
