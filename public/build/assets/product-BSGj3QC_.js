var d=1;function p(t,e,c,o,i){localStorage.setItem("currentPage",t),d=t,$.ajax({url:"/api/products/searchProduct?page"+t,type:"GET",dataType:"json",data:{page:t,product_name:e,is_sales:c,min_price:o,max_price:i},success:function(a){if(console.log(a),$("#message").hide(),a&&a.productList&&a.productList.length>0){$("#productTable tbody").empty(),$.each(a.productList,function(s,r){var n="<tr>";n+="<td>"+(s+1)+"</td>",n+='<td class="product-name" data-image="/storage/'+r.product_image+'">'+r.product_name+"</td>",n+="<td>"+(r.description||"Chưa có mô tả")+"</td>",n+="<td>"+(r.product_price||"Chưa có giá")+" VNĐ</td>",n+="<td>"+(r.is_sales===1?"Đang Bán":"Ngừng Bán")+"</td>",n+="<td>",n+='<a href="javascript:void(0);" class="edit-btn" data-id="'+r.product_id+'" title="Sửa"> <i class="bi bi-pencil-fill" style="color: #17A2B8;"></i></a> ',n+='<a href="javascript:void(0);" class="delete-product-btn" data-id="'+r.product_id+'" title="Xóa"><i class="bi bi-trash-fill" style="color: #dc3545;"></i></a>',n+="</td>",n+="</tr>",$("#productTable tbody").append(n)}),$("#pagination-top").show(),$("#pagination-bottom").show();var l=(a.pagination.current_page-1)*a.pagination.per_page+1;console.log(l);var h=Math.min(a.pagination.current_page*a.pagination.per_page,a.pagination.total);$("#start-index").text(l),$("#end-index").text(h),$("#total-products").text(a.pagination.total),a.pagination.total<=10?($("#pagination-top").hide(),$("#pagination-bottom").hide()):(u("#pagination-top",a.pagination.current_page,a.pagination.last_page),u("#pagination-bottom",a.pagination.current_page,a.pagination.last_page))}else $("#productTable tbody").empty(),$("#productTable tbody").append('<tr><td colspan="6" class="text-center">Không có khách hàng nào.</td></tr>'),$("#pagination-top").hide(),$("#pagination-bottom").hide()},error:function(a,l,h){let s="Đã xảy ra lỗi.";if(a.responseJSON){const r=a.responseJSON;if(s=r.message||s,r.errors){const n=Object.values(r.errors).flat().join(`
`);s+=`
`+n}}Swal.fire({icon:"error",title:"Lỗi!",text:s})}})}p(1,"","","","");function u(t,e,c){const o=$(t);e=e,$(t).html(""),e>1&&o.append('<a href="#" class="page-control prev" data-page="'+(e-1)+'">‹</a> ');for(var i=1;i<=c;i++)i==e?$(t).append('<a href="#" class="page active" data-page="'+i+'">'+i+"</a> "):$(t).append('<a href="#" class="page" data-page="'+i+'">'+i+"</a> ");e<c&&o.append('<a href="#" class="page-control next" data-page="'+(e+1)+'">›</a>'),o.find("a.page, a.page-control").off("click").on("click",function(a){a.preventDefault();const l=$(this).data("page");p(l,$("#search-name").val(),$("#search-status").val(),$("#search-min-price").val(),$("#search-max-price").val())})}$(document).on("mouseenter",".product-name",function(t){var e=$(this).data("image"),c=$(this).offset();$("#hover-image").attr("src",e),$("#product-image-hover").css({left:c.left+$(this).outerWidth()+-200+"px",top:c.top-150+"px"}).show()});$(document).on("mouseleave",".product-name",function(){$("#product-image-hover").hide()});$("#clear-button").click(function(){$("#search-name").val(""),$("#search-status").val(""),$("#search-min-price").val(""),$("#search-max-price").val(""),d=1,p(d,"","","","")});$("#search-button").click(function(){var t=$("#search-name").val(),e=$("#search-status").val(),c=$("#search-min-price").val(),o=$("#search-max-price").val(),i=/[!#$%^&*(),?":{}|<>]/g;if(i.test(t)){Swal.fire({icon:"warning",title:"Ký tự không hợp lệ!",text:"Vui lòng không nhập các ký tự đặc biệt!"}),$("#search-name").val("");return}if(c<0){Swal.fire({icon:"error",title:"Giá trị không hợp lệ",text:"Giá trị min_price không được nhỏ hơn 0."}),$("#search-min-price").val("");return}if(o<0){Swal.fire({icon:"error",title:"Giá trị không hợp lệ",text:"Giá trị max_price không được nhỏ hơn 0."}),$("#search-max-price").val("");return}d=1,p(d,t,e,c,o)});$("#add-new-product-button").click(function(){window.location.href="/productManager/productDetail"});$(document).on("click",".edit-btn",function(){var t=$(this).data("id");window.location.href="/productManager/productDetail/"+t});$(document).on("click",".delete-product-btn",function(){const t=$(this).data("id");var e=$("#search-name").val(),c=$("#search-status").val(),o=$("#search-min-price").val(),i=$("#search-max-price").val();Swal.fire({title:"Bạn có chắc chắn?",text:"Bạn sẽ không thể hoàn tác sau khi xóa!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Xóa",cancelButtonText:"Huỷ"}).then(a=>{a.isConfirmed&&$.ajax({url:"/api/products/delete/"+t,type:"POST",data:{product_id:t},success:function(l){console.log(l.message),l.message.includes("thành công")?(Swal.fire("Đã xoá!","Người dùng đã được xoá thành công.","success"),p(d,e,c,o,i)):Swal.fire("Lỗi!",l.message||"Xóa người dùng thất bại!","error")},error:function(){Swal.fire("Lỗi!","error")}})})});$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});
